generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Owner {
  id           Int      @id @default(autoincrement())
  username     String   @unique
  passwordHash String
  fullName     String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("owners")
}

model Pharmacy {
  id                Int                 @id @default(autoincrement())
  pharmacyId        String              @unique
  name              String?
  apiKeyHash        String
  lastUpdatedAt     DateTime?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  analyticsSnapshots AnalyticsSnapshot[]
  salesSnapshots    SalesSnapshot[]

  @@map("pharmacies")
}

model AnalyticsSnapshot {
  id         Int      @id @default(autoincrement())
  pharmacyId String
  period     String   @default("daily") // 'daily', 'weekly', 'monthly', 'yearly'
  snapshot   Json
  hash       String
  uploadedAt DateTime
  storedAt   DateTime @default(now())
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  pharmacy   Pharmacy @relation(fields: [pharmacyId], references: [pharmacyId], onDelete: Cascade)

  @@unique([pharmacyId, period])
  @@map("analytics_snapshots")
}

model SalesSnapshot {
  id         Int      @id @default(autoincrement())
  pharmacyId String
  period     String   // 'daily', 'weekly', 'monthly', 'yearly'
  snapshot   Json
  hash       String
  uploadedAt DateTime
  storedAt   DateTime @default(now())
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  pharmacy   Pharmacy @relation(fields: [pharmacyId], references: [pharmacyId], onDelete: Cascade)

  @@unique([pharmacyId, period])
  @@map("sales_snapshots")
}
